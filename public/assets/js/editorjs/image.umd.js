(function(){"use strict";try{if(typeof document<"u"){var o=document.createElement("style");o.appendChild(document.createTextNode('.image-tool{--bg-color: #cdd1e0;--front-color: #388ae5;--border-color: #e8e8eb;position:relative}.image-tool__image{border-radius:3px;overflow:hidden;margin-bottom:10px;padding-bottom:0}.image-tool__image-picture{max-width:100%;vertical-align:bottom;display:block}.image-tool__image-preloader{width:50px;height:50px;border-radius:50%;background-size:cover;margin:auto;position:relative;background-color:var(--bg-color);background-position:center center}.image-tool__image-preloader:after{content:"";position:absolute;z-index:3;width:60px;height:60px;border-radius:50%;border:2px solid var(--bg-color);border-top-color:var(--front-color);left:50%;top:50%;margin-top:-30px;margin-left:-30px;animation:image-preloader-spin 2s infinite linear;box-sizing:border-box}.image-tool__caption-container{visibility:hidden;position:absolute;bottom:10px;left:0;width:100%}.image-tool__caption{width:100%;min-height:40px;line-height:1.4;padding:8px 12px;margin-bottom:8px;border:1px solid var(--border-color);border-radius:4px;background:#fff;font-family:inherit;font-size:inherit;color:inherit}.image-tool__caption::placeholder{color:#707684;font-weight:400}.image-tool__caption:focus{outline:none;border-color:var(--front-color);box-shadow:0 0 0 2px #388ae51a}.image-tool__caption:disabled{background:#f5f5f5;color:#999}.image-tool__link-input{width:100%;min-height:40px;line-height:1.4;padding:8px 12px;border:1px solid var(--border-color);border-radius:4px;background:#fff;font-family:inherit;font-size:inherit;color:inherit}.image-tool__link-input::placeholder{color:#707684;font-weight:400}.image-tool__link-input:focus{outline:none;border-color:var(--front-color);box-shadow:0 0 0 2px #388ae51a}.image-tool__link-input:disabled{background:#f5f5f5;color:#999}.image-tool--empty .image-tool__image,.image-tool--empty .image-tool__image-preloader{display:none}.image-tool--empty .image-tool__caption-container,.image-tool--uploading .image-tool__caption-container{visibility:hidden!important}.image-tool .cdx-button{display:flex;align-items:center;justify-content:center}.image-tool .cdx-button svg{height:auto;margin:0 6px 0 0}.image-tool--filled .cdx-button,.image-tool--filled .image-tool__image-preloader{display:none}.image-tool--uploading .image-tool__image{min-height:200px;display:flex;border:1px solid var(--border-color);background-color:#fff}.image-tool--uploading .image-tool__image-picture,.image-tool--uploading .cdx-button{display:none}.image-tool--withBorder .image-tool__image{border:1px solid var(--border-color)}.image-tool--withBackground .image-tool__image{padding:15px;background:var(--bg-color)}.image-tool--withBackground .image-tool__image-picture{max-width:60%;margin:0 auto}.image-tool--stretched .image-tool__image-picture{width:100%}.image-tool--size-small{width:calc(100% - 50px);margin:0 auto}.image-tool--caption .image-tool__caption-container{visibility:visible}.image-tool--caption{padding-bottom:80px}@keyframes image-preloader-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}')),document.head.appendChild(o)}}catch(i){console.error("vite-plugin-css-injected-by-js",i)}})();
(function(j,F){typeof exports=="object"&&typeof module<"u"?module.exports=F():typeof define=="function"&&define.amd?define(F):(j=typeof globalThis<"u"?globalThis:j||self,j.ImageTool=F())})(this,function(){"use strict";const j='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19V19C9.13623 19 8.20435 19 7.46927 18.6955C6.48915 18.2895 5.71046 17.5108 5.30448 16.5307C5 15.7956 5 14.8638 5 13V12C5 9.19108 5 7.78661 5.67412 6.77772C5.96596 6.34096 6.34096 5.96596 6.77772 5.67412C7.78661 5 9.19108 5 12 5H13.5C14.8956 5 15.5933 5 16.1611 5.17224C17.4395 5.56004 18.44 6.56046 18.8278 7.83886C19 8.40666 19 9.10444 19 10.5V10.5"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16 13V16M16 19V16M19 16H16M16 16H13"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.5 17.5L17.5 6.5"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.9919 10.5H19.0015"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.9919 19H11.0015"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13L13 5"/></svg>',F='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.9919 9.5H19.0015"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.5 5H14.5096"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M14.625 5H15C17.2091 5 19 6.79086 19 9V9.375"/><path stroke="currentColor" stroke-width="2" d="M9.375 5L9 5C6.79086 5 5 6.79086 5 9V9.375"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.3725 5H9.38207"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 9.5H5.00957"/><path stroke="currentColor" stroke-width="2" d="M9.375 19H9C6.79086 19 5 17.2091 5 15V14.625"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.3725 19H9.38207"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 14.55H5.00957"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16 13V16M16 19V16M19 16H16M16 16H13"/></svg>',R='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 9L10 12M10 12L7 15M10 12H4"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9L14 12M14 12L17 15M14 12H20"/></svg>',I='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><rect width="14" height="14" x="5" y="5" stroke="currentColor" stroke-width="2" rx="4"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.13968 15.32L8.69058 11.5661C9.02934 11.2036 9.48873 11 9.96774 11C10.4467 11 10.9061 11.2036 11.2449 11.5661L15.3871 16M13.5806 14.0664L15.0132 12.533C15.3519 12.1705 15.8113 11.9668 16.2903 11.9668C16.7693 11.9668 17.2287 12.1705 17.5675 12.533L18.841 13.9634"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.7778 9.33331H13.7867"/></svg>',B='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9L20 12L17 15"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 12H20"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 9L4 12L7 15"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12H10"/></svg>',U='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M8 9V7.2C8 7.08954 8.08954 7 8.2 7L12 7M16 9V7.2C16 7.08954 15.9105 7 15.8 7L12 7M12 7L12 17M12 17H10M12 17H14"/></svg>';function M(C,n=null,r={}){const s=document.createElement(C);Array.isArray(n)?s.classList.add(...n):n!==null&&s.classList.add(n);for(const a in r)r.hasOwnProperty(a)&&(s[a]=r[a]);return s}var O=(C=>(C.Empty="empty",C.Uploading="uploading",C.Filled="filled",C))(O||{});class D{constructor({api:n,config:r,onSelectFile:s,readOnly:a}){this.api=n,this.config=r,this.onSelectFile=s,this.readOnly=a,this.nodes={wrapper:M("div",[this.CSS.baseClass,this.CSS.wrapper]),imageContainer:M("div",[this.CSS.imageContainer]),fileButton:this.createFileButton(),imageEl:void 0,imagePreloader:M("div",this.CSS.imagePreloader),captionContainer:M("div",[this.CSS.captionContainer]),caption:M("input",[this.CSS.input,this.CSS.caption],{type:"text",disabled:this.readOnly}),linkInput:M("input",[this.CSS.input,this.CSS.linkInput],{type:"text",disabled:this.readOnly})},this.nodes.caption.placeholder=this.config.captionPlaceholder??"Caption",this.nodes.linkInput.placeholder=this.config.linkPlaceholder??"Nhập đường dẫn (Tùy chọn)",this.nodes.imageContainer.appendChild(this.nodes.imagePreloader),this.nodes.captionContainer.appendChild(this.nodes.caption),this.nodes.captionContainer.appendChild(this.nodes.linkInput),this.nodes.wrapper.appendChild(this.nodes.imageContainer),this.nodes.wrapper.appendChild(this.nodes.captionContainer),this.nodes.wrapper.appendChild(this.nodes.fileButton)}applyTune(n,r){this.nodes.wrapper.classList.toggle(`${this.CSS.wrapper}--${n}`,r)}replaceTune(n,r){const s=this.nodes.wrapper,a=this.CSS.wrapper;Array.from(s.classList).forEach(i=>{i.startsWith(`${a}--${n}-`)&&s.classList.remove(i)}),s.classList.add(`${a}--${n}-${r}`)}render(){return this.toggleStatus("empty"),this.nodes.wrapper}showPreloader(n){this.nodes.imagePreloader.style.backgroundImage=`url(${n})`,this.toggleStatus("uploading")}hidePreloader(){this.nodes.imagePreloader.style.backgroundImage="",this.toggleStatus("empty")}fillImage(n){const r=/\.mp4$/.test(n)?"VIDEO":"IMG",s={src:n};let a="load";r==="VIDEO"&&(s.autoplay=!0,s.loop=!0,s.muted=!0,s.playsinline=!0,a="loadeddata"),this.nodes.imageEl=M(r,this.CSS.imageEl,s),this.nodes.imageEl.addEventListener(a,()=>{this.toggleStatus("filled"),this.nodes.imagePreloader!==void 0&&(this.nodes.imagePreloader.style.backgroundImage="")}),this.nodes.imageContainer.appendChild(this.nodes.imageEl)}fillCaption(n){this.nodes.caption!==void 0&&(this.nodes.caption.value=n)}fillLink(n){this.nodes.linkInput!==void 0&&(this.nodes.linkInput.value=n)}toggleStatus(n){for(const r in O)if(Object.prototype.hasOwnProperty.call(O,r)){const s=O[r];this.nodes.wrapper.classList.toggle(`${this.CSS.wrapper}--${s}`,s===n)}}get CSS(){return{baseClass:this.api.styles.block,loading:this.api.styles.loader,input:this.api.styles.input,button:this.api.styles.button,wrapper:"image-tool",imageContainer:"image-tool__image",imagePreloader:"image-tool__image-preloader",imageEl:"image-tool__image-picture",captionContainer:"image-tool__caption-container",caption:"image-tool__caption",linkInput:"image-tool__link-input"}}createFileButton(){const n=M("div",[this.CSS.button]);return n.innerHTML=this.config.buttonContent??`${I} ${this.api.i18n.t("Select an Image")}`,n.addEventListener("click",()=>{this.onSelectFile()}),n}}function A(C){return C&&C.__esModule&&Object.prototype.hasOwnProperty.call(C,"default")?C.default:C}var H={exports:{}};(function(C,n){(function(r,s){C.exports=s()})(window,function(){return function(r){var s={};function a(i){if(s[i])return s[i].exports;var e=s[i]={i,l:!1,exports:{}};return r[i].call(e.exports,e,e.exports,a),e.l=!0,e.exports}return a.m=r,a.c=s,a.d=function(i,e,c){a.o(i,e)||Object.defineProperty(i,e,{enumerable:!0,get:c})},a.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},a.t=function(i,e){if(1&e&&(i=a(i)),8&e||4&e&&typeof i=="object"&&i&&i.__esModule)return i;var c=Object.create(null);if(a.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:i}),2&e&&typeof i!="string")for(var y in i)a.d(c,y,(function(l){return i[l]}).bind(null,y));return c},a.n=function(i){var e=i&&i.__esModule?function(){return i.default}:function(){return i};return a.d(e,"a",e),e},a.o=function(i,e){return Object.prototype.hasOwnProperty.call(i,e)},a.p="",a(a.s=3)}([function(r,s){var a;a=function(){return this}();try{a=a||new Function("return this")()}catch{typeof window=="object"&&(a=window)}r.exports=a},function(r,s,a){(function(i){var e=a(2),c=setTimeout;function y(){}function l(o){if(!(this instanceof l))throw new TypeError("Promises must be constructed via new");if(typeof o!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],t(o,this)}function h(o,d){for(;o._state===3;)o=o._value;o._state!==0?(o._handled=!0,l._immediateFn(function(){var u=o._state===1?d.onFulfilled:d.onRejected;if(u!==null){var g;try{g=u(o._value)}catch(m){return void w(d.promise,m)}p(d.promise,g)}else(o._state===1?p:w)(d.promise,o._value)})):o._deferreds.push(d)}function p(o,d){try{if(d===o)throw new TypeError("A promise cannot be resolved with itself.");if(d&&(typeof d=="object"||typeof d=="function")){var u=d.then;if(d instanceof l)return o._state=3,o._value=d,void v(o);if(typeof u=="function")return void t((g=u,m=d,function(){g.apply(m,arguments)}),o)}o._state=1,o._value=d,v(o)}catch(f){w(o,f)}var g,m}function w(o,d){o._state=2,o._value=d,v(o)}function v(o){o._state===2&&o._deferreds.length===0&&l._immediateFn(function(){o._handled||l._unhandledRejectionFn(o._value)});for(var d=0,u=o._deferreds.length;d<u;d++)h(o,o._deferreds[d]);o._deferreds=null}function k(o,d,u){this.onFulfilled=typeof o=="function"?o:null,this.onRejected=typeof d=="function"?d:null,this.promise=u}function t(o,d){var u=!1;try{o(function(g){u||(u=!0,p(d,g))},function(g){u||(u=!0,w(d,g))})}catch(g){if(u)return;u=!0,w(d,g)}}l.prototype.catch=function(o){return this.then(null,o)},l.prototype.then=function(o,d){var u=new this.constructor(y);return h(this,new k(o,d,u)),u},l.prototype.finally=e.a,l.all=function(o){return new l(function(d,u){if(!o||o.length===void 0)throw new TypeError("Promise.all accepts an array");var g=Array.prototype.slice.call(o);if(g.length===0)return d([]);var m=g.length;function f(T,E){try{if(E&&(typeof E=="object"||typeof E=="function")){var S=E.then;if(typeof S=="function")return void S.call(E,function(x){f(T,x)},u)}g[T]=E,--m==0&&d(g)}catch(x){u(x)}}for(var b=0;b<g.length;b++)f(b,g[b])})},l.resolve=function(o){return o&&typeof o=="object"&&o.constructor===l?o:new l(function(d){d(o)})},l.reject=function(o){return new l(function(d,u){u(o)})},l.race=function(o){return new l(function(d,u){for(var g=0,m=o.length;g<m;g++)o[g].then(d,u)})},l._immediateFn=typeof i=="function"&&function(o){i(o)}||function(o){c(o,0)},l._unhandledRejectionFn=function(o){typeof console<"u"&&console&&console.warn("Possible Unhandled Promise Rejection:",o)},s.a=l}).call(this,a(5).setImmediate)},function(r,s,a){s.a=function(i){var e=this.constructor;return this.then(function(c){return e.resolve(i()).then(function(){return c})},function(c){return e.resolve(i()).then(function(){return e.reject(c)})})}},function(r,s,a){function i(t){return(i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(t)}a(4);var e,c,y,l,h,p,w,v=a(8),k=(c=function(t){return new Promise(function(o,d){t=l(t),(t=h(t)).beforeSend&&t.beforeSend();var u=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");u.open(t.method,t.url),u.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(t.headers).forEach(function(m){var f=t.headers[m];u.setRequestHeader(m,f)});var g=t.ratio;u.upload.addEventListener("progress",function(m){var f=Math.round(m.loaded/m.total*100),b=Math.ceil(f*g/100);t.progress(Math.min(b,100))},!1),u.addEventListener("progress",function(m){var f=Math.round(m.loaded/m.total*100),b=Math.ceil(f*(100-g)/100)+g;t.progress(Math.min(b,100))},!1),u.onreadystatechange=function(){if(u.readyState===4){var m=u.response;try{m=JSON.parse(m)}catch{}var f=v.parseHeaders(u.getAllResponseHeaders()),b={body:m,code:u.status,headers:f};w(u.status)?o(b):d(b)}},u.send(t.data)})},y=function(t){return t.method="POST",c(t)},l=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(t.url&&typeof t.url!="string")throw new Error("Url must be a string");if(t.url=t.url||"",t.method&&typeof t.method!="string")throw new Error("`method` must be a string or null");if(t.method=t.method?t.method.toUpperCase():"GET",t.headers&&i(t.headers)!=="object")throw new Error("`headers` must be an object or null");if(t.headers=t.headers||{},t.type&&(typeof t.type!="string"||!Object.values(e).includes(t.type)))throw new Error("`type` must be taken from module's «contentType» library");if(t.progress&&typeof t.progress!="function")throw new Error("`progress` must be a function or null");if(t.progress=t.progress||function(o){},t.beforeSend=t.beforeSend||function(o){},t.ratio&&typeof t.ratio!="number")throw new Error("`ratio` must be a number");if(t.ratio<0||t.ratio>100)throw new Error("`ratio` must be in a 0-100 interval");if(t.ratio=t.ratio||90,t.accept&&typeof t.accept!="string")throw new Error("`accept` must be a string with a list of allowed mime-types");if(t.accept=t.accept||"*/*",t.multiple&&typeof t.multiple!="boolean")throw new Error("`multiple` must be a true or false");if(t.multiple=t.multiple||!1,t.fieldName&&typeof t.fieldName!="string")throw new Error("`fieldName` must be a string");return t.fieldName=t.fieldName||"files",t},h=function(t){switch(t.method){case"GET":var o=p(t.data,e.URLENCODED);delete t.data,t.url=/\?/.test(t.url)?t.url+"&"+o:t.url+"?"+o;break;case"POST":case"PUT":case"DELETE":case"UPDATE":var d=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).type||e.JSON}(t);(v.isFormData(t.data)||v.isFormElement(t.data))&&(d=e.FORM),t.data=p(t.data,d),d!==k.contentType.FORM&&(t.headers["content-type"]=d)}return t},p=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};switch(arguments.length>1?arguments[1]:void 0){case e.URLENCODED:return v.urlEncode(t);case e.JSON:return v.jsonEncode(t);case e.FORM:return v.formEncode(t);default:return t}},w=function(t){return t>=200&&t<300},{contentType:e={URLENCODED:"application/x-www-form-urlencoded; charset=utf-8",FORM:"multipart/form-data",JSON:"application/json; charset=utf-8"},request:c,get:function(t){return t.method="GET",c(t)},post:y,transport:function(t){return t=l(t),v.selectFiles(t).then(function(o){for(var d=new FormData,u=0;u<o.length;u++)d.append(t.fieldName,o[u],o[u].name);v.isObject(t.data)&&Object.keys(t.data).forEach(function(m){var f=t.data[m];d.append(m,f)});var g=t.beforeSend;return t.beforeSend=function(){return g(o)},t.data=d,y(t)})},selectFiles:function(t){return delete(t=l(t)).beforeSend,v.selectFiles(t)}});r.exports=k},function(r,s,a){a.r(s);var i=a(1);window.Promise=window.Promise||i.a},function(r,s,a){(function(i){var e=i!==void 0&&i||typeof self<"u"&&self||window,c=Function.prototype.apply;function y(l,h){this._id=l,this._clearFn=h}s.setTimeout=function(){return new y(c.call(setTimeout,e,arguments),clearTimeout)},s.setInterval=function(){return new y(c.call(setInterval,e,arguments),clearInterval)},s.clearTimeout=s.clearInterval=function(l){l&&l.close()},y.prototype.unref=y.prototype.ref=function(){},y.prototype.close=function(){this._clearFn.call(e,this._id)},s.enroll=function(l,h){clearTimeout(l._idleTimeoutId),l._idleTimeout=h},s.unenroll=function(l){clearTimeout(l._idleTimeoutId),l._idleTimeout=-1},s._unrefActive=s.active=function(l){clearTimeout(l._idleTimeoutId);var h=l._idleTimeout;h>=0&&(l._idleTimeoutId=setTimeout(function(){l._onTimeout&&l._onTimeout()},h))},a(6),s.setImmediate=typeof self<"u"&&self.setImmediate||i!==void 0&&i.setImmediate||this&&this.setImmediate,s.clearImmediate=typeof self<"u"&&self.clearImmediate||i!==void 0&&i.clearImmediate||this&&this.clearImmediate}).call(this,a(0))},function(r,s,a){(function(i,e){(function(c,y){if(!c.setImmediate){var l,h,p,w,v,k=1,t={},o=!1,d=c.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(c);u=u&&u.setTimeout?u:c,{}.toString.call(c.process)==="[object process]"?l=function(f){e.nextTick(function(){m(f)})}:function(){if(c.postMessage&&!c.importScripts){var f=!0,b=c.onmessage;return c.onmessage=function(){f=!1},c.postMessage("","*"),c.onmessage=b,f}}()?(w="setImmediate$"+Math.random()+"$",v=function(f){f.source===c&&typeof f.data=="string"&&f.data.indexOf(w)===0&&m(+f.data.slice(w.length))},c.addEventListener?c.addEventListener("message",v,!1):c.attachEvent("onmessage",v),l=function(f){c.postMessage(w+f,"*")}):c.MessageChannel?((p=new MessageChannel).port1.onmessage=function(f){m(f.data)},l=function(f){p.port2.postMessage(f)}):d&&"onreadystatechange"in d.createElement("script")?(h=d.documentElement,l=function(f){var b=d.createElement("script");b.onreadystatechange=function(){m(f),b.onreadystatechange=null,h.removeChild(b),b=null},h.appendChild(b)}):l=function(f){setTimeout(m,0,f)},u.setImmediate=function(f){typeof f!="function"&&(f=new Function(""+f));for(var b=new Array(arguments.length-1),T=0;T<b.length;T++)b[T]=arguments[T+1];var E={callback:f,args:b};return t[k]=E,l(k),k++},u.clearImmediate=g}function g(f){delete t[f]}function m(f){if(o)setTimeout(m,0,f);else{var b=t[f];if(b){o=!0;try{(function(T){var E=T.callback,S=T.args;switch(S.length){case 0:E();break;case 1:E(S[0]);break;case 2:E(S[0],S[1]);break;case 3:E(S[0],S[1],S[2]);break;default:E.apply(y,S)}})(b)}finally{g(f),o=!1}}}}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,a(0),a(7))},function(r,s){var a,i,e=r.exports={};function c(){throw new Error("setTimeout has not been defined")}function y(){throw new Error("clearTimeout has not been defined")}function l(u){if(a===setTimeout)return setTimeout(u,0);if((a===c||!a)&&setTimeout)return a=setTimeout,setTimeout(u,0);try{return a(u,0)}catch{try{return a.call(null,u,0)}catch{return a.call(this,u,0)}}}(function(){try{a=typeof setTimeout=="function"?setTimeout:c}catch{a=c}try{i=typeof clearTimeout=="function"?clearTimeout:y}catch{i=y}})();var h,p=[],w=!1,v=-1;function k(){w&&h&&(w=!1,h.length?p=h.concat(p):v=-1,p.length&&t())}function t(){if(!w){var u=l(k);w=!0;for(var g=p.length;g;){for(h=p,p=[];++v<g;)h&&h[v].run();v=-1,g=p.length}h=null,w=!1,function(m){if(i===clearTimeout)return clearTimeout(m);if((i===y||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(m);try{i(m)}catch{try{return i.call(null,m)}catch{return i.call(this,m)}}}(u)}}function o(u,g){this.fun=u,this.array=g}function d(){}e.nextTick=function(u){var g=new Array(arguments.length-1);if(arguments.length>1)for(var m=1;m<arguments.length;m++)g[m-1]=arguments[m];p.push(new o(u,g)),p.length!==1||w||l(t)},o.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.prependListener=d,e.prependOnceListener=d,e.listeners=function(u){return[]},e.binding=function(u){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(u){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},function(r,s,a){function i(c,y){for(var l=0;l<y.length;l++){var h=y[l];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}var e=a(9);r.exports=function(){function c(){(function(p,w){if(!(p instanceof w))throw new TypeError("Cannot call a class as a function")})(this,c)}var y,l,h;return y=c,h=[{key:"urlEncode",value:function(p){return e(p)}},{key:"jsonEncode",value:function(p){return JSON.stringify(p)}},{key:"formEncode",value:function(p){if(this.isFormData(p))return p;if(this.isFormElement(p))return new FormData(p);if(this.isObject(p)){var w=new FormData;return Object.keys(p).forEach(function(v){var k=p[v];w.append(v,k)}),w}throw new Error("`data` must be an instance of Object, FormData or <FORM> HTMLElement")}},{key:"isObject",value:function(p){return Object.prototype.toString.call(p)==="[object Object]"}},{key:"isFormData",value:function(p){return p instanceof FormData}},{key:"isFormElement",value:function(p){return p instanceof HTMLFormElement}},{key:"selectFiles",value:function(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Promise(function(w,v){var k=document.createElement("INPUT");k.type="file",p.multiple&&k.setAttribute("multiple","multiple"),p.accept&&k.setAttribute("accept",p.accept),k.style.display="none",document.body.appendChild(k),k.addEventListener("change",function(t){var o=t.target.files;w(o),document.body.removeChild(k)},!1),k.click()})}},{key:"parseHeaders",value:function(p){var w=p.trim().split(/[\r\n]+/),v={};return w.forEach(function(k){var t=k.split(": "),o=t.shift(),d=t.join(": ");o&&(v[o]=d)}),v}}],(l=null)&&i(y.prototype,l),h&&i(y,h),c}()},function(r,s){var a=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,escape).replace(/%20/g,"+")},i=function(e,c,y,l){return c=c||null,y=y||"&",l=l||null,e?function(h){for(var p=new Array,w=0;w<h.length;w++)h[w]&&p.push(h[w]);return p}(Object.keys(e).map(function(h){var p,w,v=h;if(l&&(v=l+"["+v+"]"),typeof e[h]=="object"&&e[h]!==null)p=i(e[h],null,y,v);else{c&&(w=v,v=!isNaN(parseFloat(w))&&isFinite(w)?c+Number(v):v);var k=e[h];k=(k=(k=(k=k===!0?"1":k)===!1?"0":k)===0?"0":k)||"",p=a(v)+"="+a(k)}return p})).join(y).replace(/[!'()*]/g,""):""};r.exports=i}])})})(H);var N=H.exports;const _=A(N);function P(C){return C!==void 0&&typeof C.then=="function"}class q{constructor({config:n,onUpload:r,onError:s}){this.config=n,this.onUpload=r,this.onError=s}openMoxman(){var r;if(!this.config.moxman){console.error("Moxman is not configured");return}const n=document.createElement("input");n.type="hidden",n.id="moxman-input",document.body.appendChild(n),(r=this.config.moxman)==null||r.browse({fields:n.id,view:"thumbs",no_host:!0}),n.addEventListener("change",s=>{const a=s.target;this.onUpload({success:1,file:{url:a.value}}),document.body.removeChild(n)})}uploadSelectedFile({onPreview:n}){const r=function(a){const i=new FileReader;i.readAsDataURL(a),i.onload=e=>{n(e.target.result)}};let s;if(this.config.uploader&&typeof this.config.uploader.uploadByFile=="function"){const a=this.config.uploader.uploadByFile;s=_.selectFiles({accept:this.config.types??"image/*"}).then(i=>{r(i[0]);const e=a(i[0]);return P(e)||console.warn("Custom uploader method uploadByFile should return a Promise"),e})}else s=_.transport({url:this.config.endpoints.byFile,data:this.config.additionalRequestData,accept:this.config.types??"image/*",headers:this.config.additionalRequestHeaders,beforeSend:a=>{r(a[0])},fieldName:this.config.field??"image"}).then(a=>a.body);s.then(a=>{this.onUpload(a)}).catch(a=>{this.onError(a)})}uploadByUrl(n){let r;this.config.uploader&&typeof this.config.uploader.uploadByUrl=="function"?(r=this.config.uploader.uploadByUrl(n),P(r)||console.warn("Custom uploader method uploadByUrl should return a Promise")):r=_.post({url:this.config.endpoints.byUrl,data:Object.assign({url:n},this.config.additionalRequestData),type:_.contentType.JSON,headers:this.config.additionalRequestHeaders}).then(s=>s.body),r.then(s=>{this.onUpload(s)}).catch(s=>{this.onError(s)})}uploadByFile(n,{onPreview:r}){const s=new FileReader;s.readAsDataURL(n),s.onload=i=>{r(i.target.result)};let a;if(this.config.uploader&&typeof this.config.uploader.uploadByFile=="function")a=this.config.uploader.uploadByFile(n),P(a)||console.warn("Custom uploader method uploadByFile should return a Promise");else{const i=new FormData;i.append(this.config.field??"image",n),this.config.additionalRequestData&&Object.keys(this.config.additionalRequestData).length&&Object.entries(this.config.additionalRequestData).forEach(([e,c])=>{i.append(e,c)}),a=_.post({url:this.config.endpoints.byFile,data:i,type:_.contentType.JSON,headers:this.config.additionalRequestHeaders}).then(e=>e.body)}a.then(i=>{this.onUpload(i)}).catch(i=>{this.onError(i)})}}const $='<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-lane"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 6v13" /><path d="M20 6v13" /></svg>';/**
 * Image Tool for the Editor.js
 * @author CodeX <team@codex.so>
 * @license MIT
 * @see {@link https://github.com/editor-js/image}
 *
 * To developers.
 * To simplify Tool structure, we split it to 4 parts:
 *  1) index.ts — main Tool's interface, public API and methods for working with data
 *  2) uploader.ts — module that has methods for sending files via AJAX: from device, by URL or File pasting
 *  3) ui.ts — module for UI manipulations: render, showing preloader, etc
 *
 * For debug purposes there is a testing server
 * that can save uploaded files and return a Response {@link UploadResponseFormat}
 *
 *       $ node dev/server.js
 *
 * It will expose 8008 port, so you can pass http://localhost:8008 with the Tools config:
 *
 * image: {
 *   class: ImageTool,
 *   config: {
 *     endpoints: {
 *       byFile: 'http://localhost:8008/uploadFile',
 *       byUrl: 'http://localhost:8008/fetchUrl',
 *     }
 *   },
 * },
 */class L{constructor({data:n,config:r,api:s,readOnly:a,block:i}){this.isCaptionEnabled=null,this.api=s,this.block=i,this.config={endpoints:r.endpoints,moxman:r.moxman,additionalRequestData:r.additionalRequestData,additionalRequestHeaders:r.additionalRequestHeaders,field:r.field,types:r.types,captionPlaceholder:this.api.i18n.t(r.captionPlaceholder??"Caption"),linkPlaceholder:this.api.i18n.t(r.linkPlaceholder??"Nhập đường dẫn (Tùy chọn)"),buttonContent:r.buttonContent,uploader:r.uploader,actions:r.actions,features:r.features||{}},this.uploader=new q({config:this.config,onUpload:e=>this.onUpload(e),onError:e=>this.uploadingFailed(e)}),this.ui=new D({api:s,config:this.config,onSelectFile:()=>{this.uploader.openMoxman()},readOnly:a}),this._data={caption:"",withBorder:!1,withBackground:!1,stretched:!1,file:{url:""},size:"normal",link:""},this.data=n}static get isReadOnlySupported(){return!0}static get toolbox(){return{icon:I,title:"Image"}}static get tunes(){return[{name:"withBorder",icon:F,title:"With border",toggle:!0},{name:"large",icon:B,title:"Large",toggle:!1,closeOnActivate:!0,parentKey:"size"},{name:"normal",icon:$,title:"Normal",toggle:!1,closeOnActivate:!0,parentKey:"size"},{name:"small",icon:R,title:"Small",toggle:!1,closeOnActivate:!0,parentKey:"size"},{name:"withBackground",icon:j,title:"With background",toggle:!0}]}render(){var n,r,s;return(((n=this.config.features)==null?void 0:n.caption)===!0||((r=this.config.features)==null?void 0:r.caption)===void 0||((s=this.config.features)==null?void 0:s.caption)==="optional"&&this.data.caption)&&(this.isCaptionEnabled=!0,this.ui.applyTune("caption",!0)),this.ui.render()}validate(n){return!!n.file.url}save(){const n=this.ui.nodes.caption,r=this.ui.nodes.linkInput;return this._data.caption=n.value,this._data.link=r.value,this.data}renderSettings(){var i;const n=L.tunes.concat(this.config.actions||[]),r={border:"withBorder",background:"withBackground",stretch:"stretched",caption:"caption",size:"size"};((i=this.config.features)==null?void 0:i.caption)==="optional"&&n.push({name:"caption",icon:U,title:"With caption",toggle:!0});const s=n.filter(e=>{var y,l;const c=Object.keys(r).find(h=>r[h]===e.name);return c==="caption"?((y=this.config.features)==null?void 0:y.caption)!==!1:c==null||((l=this.config.features)==null?void 0:l[c])!==!1}),a=e=>{var y;let c=this.data[e.name];return e.name==="caption"&&(c=this.isCaptionEnabled??c),["normal","large","small"].includes(e.name)&&(c=((y=this==null?void 0:this._data)==null?void 0:y.size)===e.name),c};return s.map(e=>({icon:e.icon,label:this.api.i18n.t(e.title),name:e.name,toggle:e.toggle,isActive:a(e),closeOnActivate:e.closeOnActivate,onActivate:()=>{if(typeof e.action=="function"){e.action(e.name);return}if(["normal","large","small"].includes(e.name)){this.setSize(e.name);return}let c=!a(e);e.name==="caption"&&(this.isCaptionEnabled=!(this.isCaptionEnabled??!1),c=this.isCaptionEnabled),this.tuneToggled(e.name,c)}}))}appendCallback(){this.ui.nodes.fileButton.click()}static get pasteConfig(){return{tags:[{img:{src:!0}}],patterns:{image:/https?:\/\/\S+\.(gif|jpe?g|tiff|png|svg|webp)(\?[a-z0-9=]*)?$/i},files:{mimeTypes:["image/*"]}}}async onPaste(n){switch(n.type){case"tag":{const r=n.detail.data;if(/^blob:/.test(r.src)){const a=await(await fetch(r.src)).blob();this.uploadFile(a);break}this.uploadUrl(r.src);break}case"pattern":{const r=n.detail.data;this.uploadUrl(r);break}case"file":{const r=n.detail.file;this.uploadFile(r);break}}}set data(n){var r;this.image=n.file,this._data.caption=n.caption||"",this.ui.fillCaption(this._data.caption),this._data.link=n.link||"",this.ui.fillLink(this._data.link),L.tunes.forEach(({name:s,parentKey:a})=>{const i=typeof n[s]<"u"?n[s]===!0||n[s]==="true":!1;if(a==="size"){this.setSize((n==null?void 0:n.size)??"normal");return}this.setTune(s,i)}),n.caption?this.setTune("caption",!0):((r=this.config.features)==null?void 0:r.caption)===!0&&this.setTune("caption",!0)}get data(){return this._data}set image(n){this._data.file=n||{url:""},n&&n.url&&this.ui.fillImage(n.url)}onUpload(n){n.success&&n.file?this.image=n.file:this.uploadingFailed("incorrect response: "+JSON.stringify(n))}uploadingFailed(n){console.log("Image Tool: uploading failed because of",n),this.api.notifier.show({message:this.api.i18n.t("Couldn’t upload image. Please try another."),style:"error"}),this.ui.hidePreloader()}tuneToggled(n,r){n==="caption"?(this.ui.applyTune(n,r),r==!1&&(this._data.caption="",this.ui.fillCaption(""))):this.setTune(n,r)}setTune(n,r){this._data[n]=r,this.ui.applyTune(n,r),n==="stretched"&&Promise.resolve().then(()=>{this.block.stretched=r}).catch(s=>{console.error(s)})}setSize(n){this._data.size=n,this.ui.replaceTune("size",n),Promise.resolve().then(()=>{this.block.stretched=n==="large"}).catch(r=>{console.error(r)})}uploadFile(n){this.uploader.uploadByFile(n,{onPreview:r=>{this.ui.showPreloader(r)}})}uploadUrl(n){this.ui.showPreloader(n),this.uploader.uploadByUrl(n)}}return L});
